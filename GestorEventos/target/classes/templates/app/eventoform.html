<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Evento Form</title>
	<!-- Bootstrap-5.2.3 -->
	<link rel="stylesheet" th:href="@{/vendor/bootstrap-icons/bootstrap-icons.css}">
	<!-- Bootstrap-Icons -->
	<link rel="stylesheet" th:href="@{/vendor/bootstrap-5.2.3/css/bootstrap.min.css}">
	<!-- General CSS -->
	<link th:href="@{/css/app.css}" rel="stylesheet">
</head>

<body>
	<header>
		<h1>
			<strong>Event</strong><strong>App</strong>
		</h1>
		<nav>
			<div class="sidenav">
				<a class="closebtn">&times;</a> <a
					th:href="@{/admin/usuarios/{idUsuario}/eventos (idUsuario=${usuarioDTO.id})}">Volver</a>
			</div>
			<div>
				<img th:src="@{/media/img/menu.png}" alt="menu">
			</div>
		</nav>
	</header>

	<main>

		<div class="container col-lg-8 p-4 rounded shadow bg-body mt-3 text-start">

			<form th:action="@{/admin/usuarios/{idUsuario}/eventos/save (idUsuario=${usuarioDTO.id})}" method="POST"
				th:object="${eventoDTO}">

				<div class="mt-1 text-center">
					<h2 class="h2 rounded" th:text="${add} ? 'Nuevo evento' : 'Actualizar evento'"></h2>
				</div>

				<div class="mt-3" th:if="${errorMessage}" th:utext="${errorMessage}"></div>

				<div class="mt-3 row" th:if="!${add}">
					<label for="id" class="form-label col">Id</label> <input type="text" name="id"
						class="form-control-plaintext col" id="id" th:field="*{id}" readonly />
				</div>

				<div class="row mt-3">
					<div class="col-4">
						<label for="anfitrion" class="form-label">Anfitrion</label> <input readonly th:type="text"
							name="anfitrion" class="form-control" id="anfitrion"
							th:placeholder="${usuarioDTO.nombreUsuario}" th:field="*{usuarioDTO.nombreUsuario}"
							th:maxlength="40" />
					</div>
					<div class="col-8">
						<label for="nombre" class="form-label">Nombre</label> <input th:type="text" name="nombre"
							class="form-control" id="nombre" th:field="*{nombre}" th:maxlength="40" />
					</div>
				</div>

				<div class="row mt-3">
					<div class="col">
						<label for="fechaInicio" class="form-label">Fecha inicio</label> <input th:type="date"
							name="fechaInicio" class="form-control" id="fechaInicio" th:field="*{fechaInicio}"
							th:maxlength="100" />
					</div>
					<div class="col">
						<label for="fechaFin" class="form-label">Fecha Fin</label> <input th:type="date" name="fechaFin"
							class="form-control" id="fechaFin" th:field="*{fechaFin}" th:maxlength="100" />
					</div>
				</div>

				<div class="row mt-3">
					<div class="col">
						<label for="ubicacion" class="form-label">Ubicacion</label> <select id="selectUbicacion"
							name="ubicacion" th:field="*{ubicacionDTO.id}" class="form-select">
							<option selected hidden="true" value="0">Selecciona una
								ubicación</option>
							<option th:each="ubicacionDTO : ${listaUbicacionesDTO}" th:value="${ubicacionDTO.id}"
								th:text="${ubicacionDTO.nombre}">
							</option>
						</select>
					</div>
				</div>

				
				<div class="row mt-3">
					<div class="col">
						<label for="catering" class="form-label">Catering</label> <select id="selectCatering"
							name="catering" th:field="*{cateringDTO.id}" class="form-select">
							<option selected hidden="true" value="0">Selecciona un
								catering</option>

							
						</select>
					</div>
				</div>

				<div class="mt-4">
					<input type="submit" th:value="${add} ? 'Añadir' : 'Actualizar'"
						class="btn btn-outline-success w-100" />
				</div>

			</form>

		</div>
		<script th:inline="javascript" type="text/javascript">
			var ubicacionList = /*[[${listaUbicacionesDTO}]]*/[];
			var cateringList = /*[[${listaCateringsDTO}]]*/ [];
			var selectUbicacion = document.getElementById('selectUbicacion');
			var selectCatering = document.getElementById('selectCatering');
			selectUbicacion.addEventListener('change', function () {
				alert('Ha entrado');
				console.log(ubicacionList.length);
				var ubi = null;
				var idUbi = selectUbicacion.value;
				for (var i = 0; i < ubicacionList.length; i++) {
					if (ubicacionList[i].id == idUbi) {
						ubi = ubicacionList[i];
					}
				};
				console.log(ubi.id);
				var filteredCaterings = [];
				console.log(ubi.direccionDTO.provincia);
				for(var i=0; i < cateringList.length; i++){
					console.log(cateringList[i].empresaDTO.direccionDTO.provincia);
					if(cateringList[i].empresaDTO.direccionDTO.provincia == ubi.direccionDTO.provincia){
						filteredCaterings.push(cateringList[i]);
					}
				};
				
				console.log(filteredCaterings.length);
				for (var i = 0; i < filteredCaterings.length; i++) {
					var option = document.createElement('option');
					option.value = filteredCaterings[i].id;
					option.text = filteredCaterings[i].menu;
					selectCatering.appendChild(option);
				}

			});
		</script>
	</main>

	<script th:src="@{/vendor/bootstrap-5.2.3/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery-3.6.3.js}"></script>
	<script th:src="@{/js/script.js}"></script>

</body>

</html>